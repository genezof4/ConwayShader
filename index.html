<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Conway Shader</title>

    <link rel="stylesheet" type="text/css" href="main.css">

    <script type="text/javascript" src="GlBoilerplate.js"></script>
    <script type="text/javascript" src="main.js"></script>
    <script id="2d-vertex-shader" type="x-shader/x-vertex">

        attribute vec2 a_position;

        attribute vec2 a_texCoord;
        varying vec2 v_texCoord;

        void main() {
           gl_Position = vec4(a_position.x, -a_position.y, 0, 1);

           v_texCoord = a_texCoord;
        }
    </script>

    <script id="2d-fragment-shader" type="x-shader/x-fragment">
        precision mediump float;

        // our texture
        uniform sampler2D u_image;
        uniform vec2 u_textureSize;

        // the texCoords passed in from the vertex shader.
        varying vec2 v_texCoord;

        void main() {

            vec2 onePixel = vec2(1.0, 1.0)/u_textureSize;

            vec4 rawTextureData = texture2D(u_image, v_texCoord);

            bool state = rawTextureData.x == 1.0;

            int count = 0;
            for (int i=-1;i<2;i++){
                for (int j=-1;j<2;j++){
                    if (i == 0 && j == 0) continue;
                    vec2 neighborCoord = v_texCoord + vec2(onePixel.x*float(i), onePixel.y*float(j));
                    if (vec4(texture2D(u_image, neighborCoord)).r == 1.0) count++;
                }
            }

            if (state){
                if (count < 2 || count > 3) state = false;
            } else {
                if (count == 3) state = true;
            }

            float color = 0.0;
            if (state) color = 1.0;

            gl_FragColor = vec4(color,color,color,1);;
        }
    </script>
</head>
<body>

<canvas id="glcanvas"></canvas>

</body>
</html>